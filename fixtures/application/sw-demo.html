<!doctype html><html lang="zh-Hant"><head>
    <meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>SW Bypass / Update Demo</title>
    <style>
      body{font-family:ui-sans-serif,system-ui;background:#f8fafc;padding:24px}
      .card{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:16px;max-width:860px}
      button{padding:8px 12px;border:1px solid #cbd5e1;border-radius:8px;background:#f1f5f9;cursor:pointer;margin-right:8px}
      pre{background:#0b1020;color:#a8dadc;border-radius:8px;padding:12px;overflow:auto}
    </style></head><body>
    <div class="card">
      <h1>Service Worker Demo</h1>
      <div>
        <button id="regV1">註冊 v1</button>
        <button id="switchV2">切換到 v2 並更新</button>
        <button id="fetch">請求 /version.txt</button>
        <button id="unreg">反註冊全部 SW</button>
      </div>
      <pre id="log"></pre>
    </div>
    <script>
      const log=(m)=>{const el=document.getElementById('log'); el.textContent=(m+'\n'+el.textContent).slice(0,8000);};
      document.getElementById('regV1').onclick=async ()=>{
        if('serviceWorker' in navigator){
          const r = await navigator.serviceWorker.register('./sw-v1.js', {scope:'./'});
          await r.update(); log('v1 registered');
        }
      };
      document.getElementById('switchV2').onclick=async ()=>{
        if('serviceWorker' in navigator){
          const r = await navigator.serviceWorker.register('./sw-v2.js', {scope:'./'});
          await r.update(); log('v2 registered（需要 reload 或 Update on reload）');
        }
      };
      document.getElementById('fetch').onclick=async ()=>{
        const res = await fetch('./version.txt?ts='+Date.now());
        log('GET /version.txt → '+(await res.text()));
      };
      document.getElementById('unreg').onclick=async ()=>{
        const regs = await navigator.serviceWorker.getRegistrations();
        for (const r of regs) await r.unregister();
        log('All SW unregistered');
      };
    </script>
    </body></html>
    