<!doctype html><html lang="zh-Hant"><head>
    <meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>CPU Hotspot Demo</title>
    <style>
      body{font-family:ui-sans-serif,system-ui;background:#f8fafc;margin:0;padding:24px}
      .card{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:16px;max-width:860px}
      button{padding:8px 12px;border:1px solid #cbd5e1;border-radius:8px;background:#f1f5f9;cursor:pointer;margin-right:8px}
      pre{background:#0b1020;color:#a8dadc;border-radius:8px;padding:12px;overflow:auto}
    </style></head><body>
    <div class="card">
      <h1>Main / Bottom-Up / Call Tree 範例</h1>
      <button id="heavy">重計算（可能造成長任務）</button>
      <button id="heavySplit">切分計算（改善版）</button>
      <pre id="log"></pre>
    </div>
    <script>
      const log=(m)=>{const el=document.getElementById('log');el.textContent=(m+'\n'+el.textContent).slice(0,6000);};
      function heavyWork(n=6e6){
        let s=0; for(let i=0;i<n;i++){ s+=Math.sqrt(i%1000)*Math.random() }
        return s
      }
      document.getElementById('heavy').addEventListener('click', ()=>{
        const t0=performance.now(); const r=heavyWork(); const t1=performance.now();
        log(`heavy一次：${(t1-t0).toFixed(1)}ms result=${r.toFixed(1)}`);
      });
      document.getElementById('heavySplit').addEventListener('click', ()=>{
        // 切成 12 份，用 setTimeout 讓主執行緒有喘息
        let parts=12,sum=0; const chunk=Math.floor(6e6/parts);
        const run=()=>{ const t0=performance.now(); sum+=heavyWork(chunk); const dt=performance.now()-t0; log(`chunk耗時 ${dt.toFixed(1)}ms`); if(--parts>0) setTimeout(run,0); };
        run();
      });
    </script>
    </body></html>
    