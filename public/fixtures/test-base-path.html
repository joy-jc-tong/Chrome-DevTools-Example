<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <title>Base Path 測試頁</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script src="base-path.js"></script>
  <style>
    body { font-family: ui-sans-serif, system-ui, -apple-system; background:#f8fafc; padding:24px; }
    .card { background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:16px; max-width:800px; }
    .test-item { margin:12px 0; padding:12px; background:#f1f5f9; border-radius:8px; }
    .success { background:#dcfce7; border:1px solid #16a34a; }
    .error { background:#fef2f2; border:1px solid #dc2626; }
    button { padding:8px 12px; border:1px solid #cbd5e1; border-radius:8px; background:#f1f5f9; cursor:pointer; margin:4px; }
    button:hover { background:#e2e8f0; }
    pre { background:#0b1020; color:#a8dadc; border-radius:8px; padding:12px; overflow:auto; margin:8px 0; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Base Path 解決方案測試</h1>
    <p>此頁面用來測試 GitHub Pages 子路徑部署時的資源路徑修正功能。</p>

    <div class="test-item">
      <h3>1. 基礎路徑檢測</h3>
      <p>當前基礎路徑：<code id="base-path-display"></code></p>
      <p>預期在 GitHub Pages 上應該顯示：<code>/Chrome-DevTools-Example/</code></p>
    </div>

    <div class="test-item">
      <h3>2. 資源路徑解析測試</h3>
      <button onclick="testResourcePath()">測試資源路徑解析</button>
      <pre id="resource-test-result"></pre>
    </div>

    <div class="test-item">
      <h3>3. 圖片載入測試</h3>
      <button onclick="testImageLoading()">載入測試圖片</button>
      <div id="image-test-result"></div>
    </div>

    <div class="test-item">
      <h3>4. API 請求測試</h3>
      <button onclick="testApiRequest()">測試 API 請求</button>
      <pre id="api-test-result"></pre>
    </div>

    <div class="test-item">
      <h3>5. Preload Link 測試</h3>
      <p>檢查頁面中的 preload link 是否被自動修正：</p>
      <pre id="preload-test-result"></pre>
    </div>
  </div>

  <script>
    // 顯示基礎路徑
    document.getElementById('base-path-display').textContent = getBasePath();

    // 測試資源路徑解析
    function testResourcePath() {
      const testPaths = [
        'fixtures/network/img-1.png',
        '/fixtures/network/img-1.png',
        'img-1.png'
      ];
      
      const results = testPaths.map(path => {
        const resolved = resolveResourcePath(path);
        return `原始路徑: "${path}" → 解析後: "${resolved}"`;
      });
      
      document.getElementById('resource-test-result').textContent = results.join('\n');
    }

    // 測試圖片載入
    function testImageLoading() {
      const img = new Image();
      const basePath = getBasePath();
      img.src = basePath + 'fixtures/network/img-1.png';
      
      img.onload = function() {
        document.getElementById('image-test-result').innerHTML = 
          '<div class="success">✅ 圖片載入成功</div><img src="' + img.src + '" style="max-width:200px; margin-top:8px;">';
      };
      
      img.onerror = function() {
        document.getElementById('image-test-result').innerHTML = 
          '<div class="error">❌ 圖片載入失敗</div>';
      };
    }

    // 測試 API 請求
    function testApiRequest() {
      const basePath = getBasePath();
      fetch(basePath + 'fixtures/network/rt-a.json')
        .then(response => response.json())
        .then(data => {
          document.getElementById('api-test-result').textContent = 
            '✅ API 請求成功\n回應資料: ' + JSON.stringify(data);
        })
        .catch(error => {
          document.getElementById('api-test-result').textContent = 
            '❌ API 請求失敗\n錯誤: ' + error.message;
        });
    }

    // 檢查 preload link
    function checkPreloadLinks() {
      const preloadLinks = document.querySelectorAll('link[rel="preload"]');
      const results = Array.from(preloadLinks).map(link => {
        return `href: "${link.href}"`;
      });
      
      document.getElementById('preload-test-result').textContent = 
        results.length > 0 ? results.join('\n') : '沒有找到 preload link';
    }

    // 頁面載入完成後執行檢查
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(checkPreloadLinks, 100); // 等待 base-path.js 處理完成
    });
  </script>
</body>
</html>
